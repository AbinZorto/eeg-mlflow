# Processing Pipeline Configuration

# Paths
paths:
  raw_data: "eeg_analysis/data/raw/MDD_21_subjects_EC_EEG_data_remission_and_non_remission_seperated.mat"
  interim:
    upsampled: "data/processed/interim/upsampled"
    filtered: "data/processed/interim/filtered"
    downsampled: "data/processed/interim/downsampled"
    windowed: "data/processed/interim/windowed"
  features:
    window: "data/processed/features/window_features.parquet"
    patient: "data/processed/features/patient_features.parquet"

# Data Loader Parameters
data_loader:
  # Channel Selection: Customize which EEG channels to process
  # Available channels: ['af7', 'af8', 'tp9', 'tp10']
  # 
  # Features extracted per channel combination:
  # - Individual channel features (spectral, temporal, entropy for each channel)
  # - Traditional asymmetry: frontal (af7/af8), temporal (tp9/tp10)
  # - Hemispheric asymmetry: left hemisphere (af7+tp9) vs right hemisphere (af8+tp10)
  # - Cross-regional: frontal-temporal ratios within each hemisphere
  # - Diagonal cross-hemispheric: af7-tp10 and af8-tp9 interactions
  # - Coherence/correlation between all channel pairs
  #
  channels: ['af7', 'af8', 'tp9', 'tp10']  # Current: All 4 channels (enables all features)
  # channels: ['af7', 'af8']              # Frontal only (enables frontal asymmetry + coherence)
  # channels: ['tp9', 'tp10']             # Temporal only (enables temporal asymmetry + coherence)
  # channels: ['af7', 'tp9']              # Left hemisphere (enables cross-regional + coherence)
  # channels: ['af8', 'tp10']             # Right hemisphere (enables cross-regional + coherence)
  # channels: ['af7']                     # Single channel (individual features only)
  validate_data: true
  save_interim: true
  data_keys:
    non_remission: "EEG_windows_Non_remission"
    remission: "EEG_windows_Remission"

# Signal Processing Parameters
upsampler:
  factor: 2
  method: 'linear'
  save_interim: true

filter:
  type: 'butterworth'
  order: 4
  cutoff_frequency: 60
  sampling_rate: 256  # After upsampling
  save_interim: true

downsampler:
  factor: 2
  method: 'decimate'
  save_interim: true

# Window Slicer Parameters
window_slicer:
  window_seconds: 10
  sampling_rate: 256  # After downsampling
  overlap_seconds: 0
  min_windows: 10  # Minimum windows per participant
  save_interim: true

# Feature Extraction Parameters
feature_extractor:
  # Window Ordering Configuration - NEW FEATURE
  # Controls how windows are ordered in the final feature dataset
  preserve_window_order: true   # Set to false for legacy behavior
  ordering_method: "completion"  # Options: "sequential" or "completion"
  # 
  # SEQUENTIAL (recommended): Preserves temporal relationships
  # - Windows appear in the same order as input (participant -> parent_window -> sub_window)
  # - Better for ML models as it maintains temporal context
  # - Slightly slower due to result reordering
  # 
  # COMPLETION (legacy): Processes in parallel completion order  
  # - Windows appear in the order parallel processing completes them
  # - Faster processing but scrambles temporal relationships
  # - May hurt ML model performance due to random ordering
  
  # Feature computation control - set to false to disable entire feature categories
  compute_spectral: true      # Band powers, relative powers, PSD statistics, spectral edge frequencies
  compute_temporal: true      # Statistical features, Hjorth parameters
  compute_entropy: true       # Sample entropy, spectral entropy
  compute_complexity: true    # Correlation dimension, Hurst exponent, Lyapunov, DFA
  compute_connectivity: true  # Cross-correlation between channel pairs
  compute_asymmetry: true     # Frontal and temporal asymmetry features
  compute_cross_hemispheric: true  # Hemispheric asymmetry and cross-regional features
  compute_coherence: true     # Inter-channel coherence and correlation measures
  
  # Detailed feature selection within each category
  spectral_features:
    band_powers: true         # Individual frequency band powers per channel (5 features: delta, theta, alpha, beta, gamma)
    relative_powers: true    # Relative band powers (normalized by total power)
    total_power: true        # Total power across all bands
    freq_weighted_power: true # Frequency-weighted power
    spectral_edge_freq: true  # SEF 90% and 95%
    psd_statistics: true     # PSD mean, std, max, min, median, skewness, kurtosis
  
  temporal_features:
    basic_statistics: true    # mean, std, var, skew, kurtosis, rms, peak_to_peak, etc.
    hjorth_parameters: true   # Activity, mobility, complexity
  
  entropy_features:
    sample_entropy: true      # Sample entropy per channel (1 feature)
    spectral_entropy: true   # Spectral entropy per channel
  
  complexity_features:
    correlation_dimension: true   # Correlation dimension
    hurst_exponent: true         # Hurst exponent
    lyapunov_exponent: true      # Lyapunov exponent
    dfa: true                    # Detrended Fluctuation Analysis
  
  connectivity_features:
    cross_correlation: true   # Cross-correlation between channel pairs
  
  asymmetry_features:
    frontal_asymmetry: true   # AF7/AF8 asymmetry (requires both channels)
    temporal_asymmetry: true  # TP9/TP10 asymmetry (requires both channels)
  
  cross_hemispheric_features:
    hemispheric_asymmetry: true     # Left vs right hemisphere (requires all 4 channels)
    frontal_temporal_ratios: true   # Within-hemisphere frontal-temporal ratios
    diagonal_cross_hemispheric: true # AF7-TP10 and AF8-TP9 interactions
  
  coherence_features:
    max_coherence: true       # Maximum coherence between channel pairs
    pearson_correlation: true # Pearson correlation between channel pairs
  
  frequency_bands:
    delta: [0.5, 4]
    theta: [4, 8]
    alpha: [8, 12]
    beta: [12, 30]
    gamma: [30, 60]
  
  # Legacy feature lists (for backward compatibility) - keeping for reference but using new structure above
  statistical_features:
    - mean
    - std
    - variance
    - skewness
    - kurtosis
    - rms
    - zero_crossings
    - peak_to_peak
    - mean_abs_deviation
  
  validation:
    check_nan: true
    check_infinite: true
    remove_invalid: false
  
  save_interim: true

# MLflow Tracking
mlflow:
  experiment_name: "eeg_processing"
  tracking_uri: "mlruns"
  run_name: "{window_size}s_window"

# Logging Configuration
logging:
  level: "INFO"
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
  file: "logs/processing.log"
  console: true